# Saturn MouseHunter Crawler Service

Saturn MouseHunter åˆ†å¸ƒå¼çˆ¬è™«å¾®æœåŠ¡ - è´Ÿè´£ä»Dragonflyä»»åŠ¡é˜Ÿåˆ—æ¶ˆè´¹çˆ¬å–ä»»åŠ¡ï¼Œæ‰§è¡ŒWebæ•°æ®æŠ“å–ã€‚

## æœåŠ¡æ¦‚è¿°

æœ¬æœåŠ¡æ˜¯Saturn MouseHunterç³»ç»Ÿä¸­çš„ä¸‹æ¸¸çˆ¬è™«å¾®æœåŠ¡ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

- ğŸš€ **Dragonflyä»»åŠ¡é˜Ÿåˆ—æ¶ˆè´¹**: ç›‘å¬å¹¶æ¶ˆè´¹æ¥è‡ªè°ƒåº¦å™¨çš„çˆ¬å–ä»»åŠ¡
- ğŸ”„ **Cookieå’Œä»£ç†æ³¨å…¥**: åŸºäºä»»åŠ¡ç±»å‹è‡ªåŠ¨æ³¨å…¥ä»£ç†å’ŒCookie
- ğŸŒ **HTTPçˆ¬è™«å¼•æ“**: é«˜æ€§èƒ½å¼‚æ­¥HTTPæ•°æ®æŠ“å–
- ğŸ“Š **ä»»åŠ¡çŠ¶æ€ä¸ŠæŠ¥**: å®æ—¶ä¸ŠæŠ¥ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å’Œè¶…æ—¶é‡è¯•
- ğŸ” **ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†**: çˆ¬è™«æ€§èƒ½æŒ‡æ ‡å’Œè¿è¡ŒçŠ¶æ€ç›‘æ§

## æ¶æ„è®¾è®¡

### å¾®æœåŠ¡æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Saturn MouseHunterç³»ç»Ÿ           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ è°ƒåº¦å™¨æœåŠ¡   â”‚  â”‚ è®¤è¯æœåŠ¡             â”‚â”‚
â”‚ â”‚ (8000)      â”‚  â”‚ (8001)              â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚        â”‚                                â”‚
â”‚        â”‚ Dragonfly Queue                â”‚
â”‚        â–¼                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚       çˆ¬è™«æœåŠ¡ (8006)               â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚ â”‚  â”‚ä»»åŠ¡æ¶ˆè´¹è€…    â”‚ â”‚ä»£ç†æ± é›†æˆ        â”‚â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚ â”‚  â”‚çˆ¬è™«å¼•æ“     â”‚ â”‚çŠ¶æ€ä¸ŠæŠ¥          â”‚â”‚ â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚                      â”‚
â”‚                  â–¼                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚       ä»£ç†æ± æœåŠ¡ (8005)              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»»åŠ¡æµç¨‹
1. **ä»»åŠ¡æ¥æ”¶**: ä»Dragonflyé˜Ÿåˆ—æ¥æ”¶çˆ¬å–ä»»åŠ¡
2. **èµ„æºæ³¨å…¥**: æ ¹æ®ä»»åŠ¡ç±»å‹æ³¨å…¥ä»£ç†å’ŒCookie
3. **æ•°æ®æŠ“å–**: æ‰§è¡ŒHTTPè¯·æ±‚å¹¶è§£ææ•°æ®
4. **çŠ¶æ€ä¸ŠæŠ¥**: å®æ—¶ä¸ŠæŠ¥ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€
5. **ç»“æœå­˜å‚¨**: å°†æŠ“å–ç»“æœå‘é€åˆ°ç›®æ ‡ç³»ç»Ÿ

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.12+
- Redis (Dragonfly) 6.0+
- ä»£ç†æ± æœåŠ¡ (å¯é€‰)

### å®‰è£…ä¾èµ–
```bash
cd saturn-mousehunter-crawler-service
uv sync
```

### é…ç½®ç¯å¢ƒ
å¤åˆ¶å¹¶ç¼–è¾‘ç¯å¢ƒé…ç½®æ–‡ä»¶ï¼š
```bash
cp .env.example .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œè®¾ç½®å¿…è¦çš„é…ç½®é¡¹
```

### å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘ç¯å¢ƒ
CRAWLER_SERVICE_PORT=8006 uv run python -m main

# ç”Ÿäº§ç¯å¢ƒ
uv run python -m main
```

## é…ç½®è¯´æ˜

### æ ¸å¿ƒé…ç½®é¡¹

#### æœåŠ¡é…ç½®
```env
CRAWLER_SERVICE_PORT=8006       # æœåŠ¡ç«¯å£
DEBUG=false                     # è°ƒè¯•æ¨¡å¼
LOG_LEVEL=INFO                  # æ—¥å¿—çº§åˆ«
```

#### Dragonflyé˜Ÿåˆ—é…ç½®
```env
DRAGONFLY_HOST=192.168.8.188    # Dragonflyä¸»æœº
DRAGONFLY_PORT=30010            # Dragonflyç«¯å£
DRAGONFLY_DB=0                  # æ•°æ®åº“ç´¢å¼•
```

#### å·¥ä½œå™¨é…ç½®
```env
WORKER_ID=crawler-worker-01     # å·¥ä½œå™¨ID
MAX_CONCURRENT_TASKS=5          # æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°
TASK_TIMEOUT_SECONDS=300        # ä»»åŠ¡è¶…æ—¶æ—¶é—´
```

#### ä»»åŠ¡ç±»å‹æ”¯æŒ
```env
SUPPORTED_TASK_TYPES=1m_realtime,5m_realtime,15m_realtime,15m_backfill,1d_backfill
SUPPORTED_MARKETS=CN,US,HK
```

## APIæ¥å£

### å¥åº·æ£€æŸ¥
- `GET /health/status` - æœåŠ¡çŠ¶æ€æ£€æŸ¥
- `GET /health/ready` - å°±ç»ªçŠ¶æ€æ£€æŸ¥

### çˆ¬è™«ç®¡ç†
- `GET /api/v1/crawler/stats` - çˆ¬è™«ç»Ÿè®¡ä¿¡æ¯
- `GET /api/v1/crawler/tasks/active` - æ´»è·ƒä»»åŠ¡åˆ—è¡¨
- `POST /api/v1/crawler/tasks/{task_id}/cancel` - å–æ¶ˆä»»åŠ¡

### ç›‘æ§æŒ‡æ ‡
- `GET /metrics` - Prometheusæ ¼å¼æŒ‡æ ‡

## å¼€å‘æŒ‡å—

### ç›®å½•ç»“æ„
```
src/
â”œâ”€â”€ application/          # åº”ç”¨æœåŠ¡å±‚
â”‚   â”œâ”€â”€ consumer/        # Dragonflyä»»åŠ¡æ¶ˆè´¹è€…
â”‚   â””â”€â”€ services/        # ä¸šåŠ¡æœåŠ¡
â”œâ”€â”€ domain/              # é¢†åŸŸæ¨¡å‹
â”œâ”€â”€ infrastructure/      # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ crawler/        # çˆ¬è™«å¼•æ“
â”‚   â”œâ”€â”€ proxy/          # ä»£ç†ç®¡ç†
â”‚   â””â”€â”€ settings/       # é…ç½®ç®¡ç†
â””â”€â”€ interfaces/          # æ¥å£å±‚
    â””â”€â”€ api/            # REST API
```

### æ·»åŠ æ–°çš„ä»»åŠ¡å¤„ç†å™¨
```python
from application.consumer.dragonfly_task_consumer import CrawlerTaskConsumer

# æ³¨å†Œä»»åŠ¡å¤„ç†å™¨
@crawler_consumer.register_task_handler("custom_task_type")
async def handle_custom_task(task: DragonflyTask) -> bool:
    # å®ç°è‡ªå®šä¹‰ä»»åŠ¡å¤„ç†é€»è¾‘
    return True
```

### ä»»åŠ¡ç±»å‹é…ç½®
æ”¯æŒçš„ä»»åŠ¡ç±»å‹ä¸é˜Ÿåˆ—ä¼˜å…ˆçº§æ˜ å°„ï¼š
- `1m_realtime` â†’ CRITICALä¼˜å…ˆçº§ï¼ˆæŒ‡æ ‡å‹é˜Ÿåˆ—ï¼‰
- `5m_realtime` â†’ CRITICALä¼˜å…ˆçº§ï¼ˆçƒ­ç‚¹å‹é˜Ÿåˆ—ï¼‰
- `15m_realtime` â†’ HIGHä¼˜å…ˆçº§ï¼ˆå…¨é‡å‹é˜Ÿåˆ—ï¼‰
- `15m_backfill` â†’ MEDIUMä¼˜å…ˆçº§ï¼ˆå…¨é‡å‹é˜Ÿåˆ—ï¼‰
- `1d_backfill` â†’ LOWä¼˜å…ˆçº§ï¼ˆå…¨é‡å‹é˜Ÿåˆ—ï¼‰

## ç›‘æ§å’Œè¿ç»´

### æ—¥å¿—ç®¡ç†
æœåŠ¡ä½¿ç”¨loguruè¿›è¡Œç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼š
```python
from saturn_mousehunter_shared.log.logger import get_logger
log = get_logger(__name__)

log.info("ä»»åŠ¡æ‰§è¡ŒæˆåŠŸ", task_id=task_id, duration=duration)
```

### æ€§èƒ½æŒ‡æ ‡
- ä»»åŠ¡æ¶ˆè´¹é€Ÿç‡
- ä»»åŠ¡æ‰§è¡ŒæˆåŠŸç‡
- å¹³å‡ä»»åŠ¡æ‰§è¡Œæ—¶é—´
- æ´»è·ƒè¿æ¥æ•°
- ä»£ç†å¯ç”¨æ€§

### æ•…éšœæ’æŸ¥
1. **ä»»åŠ¡æ¶ˆè´¹å¼‚å¸¸**: æ£€æŸ¥Dragonflyè¿æ¥å’Œé˜Ÿåˆ—é…ç½®
2. **ä»£ç†è¿æ¥å¤±è´¥**: æ£€æŸ¥ä»£ç†æ± æœåŠ¡å¯ç”¨æ€§
3. **ä»»åŠ¡æ‰§è¡Œè¶…æ—¶**: è°ƒæ•´`TASK_TIMEOUT_SECONDS`é…ç½®
4. **å¹¶å‘é™åˆ¶**: è°ƒæ•´`MAX_CONCURRENT_TASKS`é…ç½®

## éƒ¨ç½²è¯´æ˜

### Dockeréƒ¨ç½²
```dockerfile
FROM python:3.12-slim
WORKDIR /app
COPY . .
RUN pip install uv && uv sync
EXPOSE 8006
CMD ["uv", "run", "python", "-m", "main"]
```

### Kuberneteséƒ¨ç½²
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: crawler-service
spec:
  replicas: 3
  selector:
    matchLabels:
      app: crawler-service
  template:
    metadata:
      labels:
        app: crawler-service
    spec:
      containers:
      - name: crawler-service
        image: saturn-mousehunter-crawler-service:latest
        ports:
        - containerPort: 8006
        env:
        - name: CRAWLER_SERVICE_PORT
          value: "8006"
        - name: DRAGONFLY_HOST
          value: "dragonfly-service"
```

## è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æ‰“å¼€ Pull Request

## è”ç³»æ–¹å¼

- é¡¹ç›®åœ°å€: https://github.com/cenwei/saturn-mousehunter-crawler-service
- é—®é¢˜åé¦ˆ: https://github.com/cenwei/saturn-mousehunter-crawler-service/issues